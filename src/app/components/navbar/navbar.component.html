<div
  class="offcanvas-backdrop"
  [class.is-visible]="isOffcanvasOpen()"
  (click)="closeOffcanvas()"
></div>

<nav
  class="navbar navbar-expand-lg navbar-light fixed-top transition-navbar"
  [class.navbar-transparent]="isHome && !hasScrolled()"
  [class.bg-white]="!isHome || hasScrolled()"
  [class.shadow-sm]="!isHome || hasScrolled()"
>
  <div class="container">
    <a class="navbar-logo d-flex align-items-center" routerLink="/">
      <img
        src="logo.webp"
        alt="Logo CEDP"
        class="me-2 logo-img"
        style="height: 75px"
      />
    </a>

    <button class="navbar-toggler" type="button" (click)="toggleOffcanvas()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div
      class="collapse navbar-collapse d-none d-lg-flex"
      id="navbarNavDesktop"
    >
      <div class="search-container mx-auto">
        <i class="fas fa-search search-icon"></i>
        <input
          type="text"
          class="form-control search-input"
          placeholder="Buscar cursos, diplomados..."
        />
      </div>
      <ul class="navbar-nav ms-auto align-items-lg-center">
        <li class="nav-item">
          <a
            class="nav-link"
            routerLink="/"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
            ><i class="fas fa-home me-1"></i> Inicio</a
          >
        </li>

        <li class="nav-item dropdown position-static hover-trigger">
          <a
            class="nav-link dropdown-toggle"
            routerLink="/cursos"
            routerLinkActive="active"
          >
            <i class="fas fa-book me-1"></i> Cursos
          </a>
          <div class="dropdown-menu mega-menu">
            <div class="container">
              <div class="row">
                <div
                  class="col-lg-3 col-md-6 mega-menu-category"
                  *ngFor="let categoria of categoriasCursos"
                >
                  <h6 class="mega-menu-title">
                    <i class="fas fa-book me-2"></i> {{ categoria.nombre }}
                  </h6>
                  <a
                    [routerLink]="['/cursos']"
                    [queryParams]="{ cat: categoria.id }"
                    class="mega-menu-item"
                    >Ver cursos</a
                  >
                </div>
              </div>
            </div>
          </div>
        </li>

        <li class="nav-item dropdown position-static hover-trigger">
          <a
            class="nav-link dropdown-toggle"
            routerLink="/diplomados"
            routerLinkActive="active"
          >
            <i class="fas fa-certificate me-1"></i> Diplomados
          </a>
          <div class="dropdown-menu mega-menu">
            <div class="container">
              <div class="row">
                <div
                  class="col-lg-3 col-md-6 mega-menu-category"
                  *ngFor="let categoria of categoriasDiplomados"
                >
                  <h6 class="mega-menu-title">
                    <i class="fas fa-certificate me-2"></i>
                    {{ categoria.nombre }}
                  </h6>
                  <a
                    [routerLink]="['/diplomados']"
                    [queryParams]="{ cat: categoria.id }"
                    class="mega-menu-item"
                    >Ver diplomados</a
                  >
                </div>
              </div>
            </div>
          </div>
        </li>
        <li class="nav-item d-flex align-items-center ms-lg-3">
          
          <div class="dropdown hover-trigger">
            <a
              class="nav-link dropdown-toggle d-flex align-items-center"
              href="#"
              (click)="$event.preventDefault()"
              ><span>Mi Cuenta</span></a
            >
            <ul class="dropdown-menu dropdown-menu-end">
              <ng-container *ngIf="isAuthenticated(); else loggedOut">
                <li>
                  <a class="dropdown-item" routerLink="/admin">
                    <i class="fas fa-user me-2"></i>Mi Perfil
                  </a>
                </li>
                <li>
                  <hr class="dropdown-divider" />
                </li>
                <li>
                  <a
                    class="dropdown-item text-danger"
                    href="#"
                    (click)="onLogout()"
                  >
                    <i class="fas fa-sign-out-alt me-2"></i>Cerrar sesi贸n
                  </a>
                </li>
              </ng-container>
              <ng-template #loggedOut>
                <li>
                  <a class="dropdown-item" routerLink="/login">
                    <i class="fas fa-sign-in-alt me-2"></i>Iniciar sesi贸n
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" [routerLink]="['/register']">
                    <i class="fas fa-user-plus me-2"></i>Registrarse
                  </a>
                </li>
              </ng-template>
            </ul>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="offcanvas-menu" [class.is-open]="isOffcanvasOpen()">
  <div class="offcanvas-header-mobile">
    <a class="btn-back" *ngIf="currentView() !== 'main'" (click)="goBack()"
      ><i class="fas fa-arrow-left me-2"></i> Volver</a
    >
    <button
      type="button"
      class="btn-close-mobile"
      (click)="closeOffcanvas()"
    ></button>
  </div>

  <div class="offcanvas-body-mobile">
    <div *ngIf="currentView() === 'main'" class="mobile-view">
      <a class="mobile-nav-item" routerLink="/">
        <div class="mobile-nav-icon"><i class="fas fa-home"></i></div>
        <div class="mobile-nav-text"><span class="title">Inicio</span></div>
      </a>
      <hr class="divisor" />
      <a class="mobile-nav-item" (click)="setView('cursos')">
        <div class="mobile-nav-icon"><i class="fas fa-book-open"></i></div>
        <div class="mobile-nav-text"><span class="title">Cursos</span></div>
        <div class="mobile-nav-arrow"><i class="fas fa-chevron-right"></i></div>
      </a>
      <hr class="divisor" />
      <a class="mobile-nav-item" (click)="setView('diplomados')">
        <div class="mobile-nav-icon"><i class="fas fa-stamp"></i></div>
        <div class="mobile-nav-text"><span class="title">Diplomados</span></div>
        <div class="mobile-nav-arrow"><i class="fas fa-chevron-right"></i></div>
      </a>
      <hr class="" />
      <ng-container *ngIf="isAuthenticated(); else mobileLoggedOut">
        <a class="mobile-nav-item" routerLink="/perfil">
          <div class="mobile-nav-icon"><i class="fas fa-user"></i></div>
          <div class="mobile-nav-text"><span class="title">Perfil</span></div>
        </a>
        <hr class="divisor" />
        <a class="mobile-nav-item" href="#" (click)="onLogout()">
          <div class="mobile-nav-icon"><i class="fas fa-sign-out-alt"></i></div>
          <div class="mobile-nav-text">
            <span class="title">Cerrar sesi贸n</span>
          </div>
        </a>
      </ng-container>
      <ng-template #mobileLoggedOut>
        <a class="mobile-nav-item" routerLink="/login">
          <div class="mobile-nav-icon"><i class="fas fa-sign-in-alt"></i></div>
          <div class="mobile-nav-text">
            <span class="title">Iniciar sesi贸n</span>
          </div>
        </a>
        <hr class="divisor" />
        <a class="mobile-nav-item" [routerLink]="['/registro']">
          <div class="mobile-nav-icon"><i class="fas fa-user-plus"></i></div>
          <div class="mobile-nav-text">
            <span class="title">Registrarse</span>
          </div>
        </a>
      </ng-template>
    </div>

    <div *ngIf="currentView() === 'cursos'" class="mobile-view">
      <div class="submenu-header-card">
        <div class="mobile-nav-icon"><i class="fas fa-book-open"></i></div>
        <div class="mobile-nav-text"><span class="title">Cursos</span></div>
      </div>
      <div class="accordion accordion-flush" id="cursosSubmenuAccordion">
        <div
          class="accordion-item"
          *ngFor="let categoria of categoriasCursos; let idx = index"
        >
          <h2 class="accordion-header">
            <button
              class="accordion-button collapsed"
              type="button"
              data-bs-toggle="collapse"
              [attr.data-bs-target]="'#c' + idx"
            >
              {{ categoria.nombre }}
            </button>
          </h2>
          <div
            [id]="'c' + idx"
            class="accordion-collapse collapse"
            data-bs-parent="#cursosSubmenuAccordion"
          >
            <div class="accordion-body">
              <a
                [routerLink]="['/cursos']"
                [queryParams]="{ cat: categoria.id }"
                class="submenu-item"
                >Ver cursos de {{ categoria.nombre }}</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="currentView() === 'diplomados'" class="mobile-view">
      <div class="submenu-header-card">
        <div class="mobile-nav-icon"><i class="fas fa-stamp"></i></div>
        <div class="mobile-nav-text"><span class="title">Diplomados</span></div>
      </div>
      <div class="accordion accordion-flush" id="diplomadosSubmenuAccordion">
        <div
          class="accordion-item"
          *ngFor="let categoria of categoriasDiplomados; let idx = index"
        >
          <h2 class="accordion-header">
            <button
              class="accordion-button collapsed"
              type="button"
              data-bs-toggle="collapse"
              [attr.data-bs-target]="'#d' + idx"
            >
              {{ categoria.nombre }}
            </button>
          </h2>
          <div
            [id]="'d' + idx"
            class="accordion-collapse collapse"
            data-bs-parent="#diplomadosSubmenuAccordion"
          >
            <div class="accordion-body">
              <a
                [routerLink]="['/diplomados']"
                [queryParams]="{ cat: categoria.id }"
                class="submenu-item"
                >Ver diplomados de {{ categoria.nombre }}</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
