<section class="curso-container container">
  @if (isLoading()) {
    <div class="text-center mt-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>
  }

  @if (!isLoading() && curso()) {
    <div class="text-start mb-4">
      <h2 class="fw-bold text-uppercase">{{ curso()?.tipo ? 'Diplomado en' : 'Curso de' }}</h2>
      <h1 class="fw-bolder text-uppercase text-highlight">
        {{ curso()?.titulo }}
      </h1>
    </div>

    @if ((curso()?.programaciones || []).length > 0) {
      <div class="row g-3 mb-4">
        @for (programacion of (curso()?.programaciones || []); track programacion.idProgramacionCurso; let i = $index) {
          @if (i === 0) {
            <div class="col-md-6 col-lg-3">
              <div class="info-box p-3 h-100 text-center">
                <div class="icon mb-2">
                  <i class="bi bi-laptop fs-2"></i>
                </div>
                <h5 class="fw-bold mb-1">Modalidad:</h5>
                <p>{{ getModalidadLabel(programacion.modalidad) }}</p>
              </div>
            </div>

            <div class="col-md-6 col-lg-3">
              <div class="info-box p-3 h-100 text-center">
                <div class="icon mb-2">
                  <i class="bi bi-clock fs-2"></i>
                </div>
                <h5 class="fw-bold mb-1">Duración:</h5>
                <p>{{ programacion.duracionCurso }} Horas</p>
              </div>
            </div>
          }
        }

        <div class="col-lg-6">
          <div class="grid-box p-3 h-100">
            <h5 class="fw-bold mb-3 text-center">Programaciones Disponibles</h5>
            <div class="table-responsive">
              <table class="table table-sm table-striped">
                <thead>
                  <tr>
                    <th>Docente</th>
                    <th>Horario</th>
                    <th>Inicio</th>
                    <th>Modalidad</th>
                    <th>Precio</th>
                  </tr>
                </thead>
                <tbody>
                  @for (prog of (curso()?.programaciones || []); track prog.idProgramacionCurso) {
                    <tr>
                      <td>{{ getNombreCompleto(prog) }}</td>
                      <td>{{ prog.horario || 'Por definir' }}</td>
                      <td>{{ prog.fechaInicio | date: 'dd/MM/yyyy' }}</td>
                      <td>{{ getModalidadLabel(prog.modalidad) }}</td>
                      <td>S/. {{ prog.monto | number: '1.2-2' }}</td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    }

    @if (curso()?.objetivo) {
      <div class="card p-4 mb-4 about-box">
        <h5 class="fw-bold text-uppercase mb-3">Acerca de este {{ curso()?.tipo ? 'diplomado' : 'curso' }}:</h5>
        <p>{{ curso()?.objetivo }}</p>
      </div>
    }

    <div class="row g-3 mb-4">
      <div class="col-md-6">
        <div class="card p-3 h-100 materials-box">
          <h5 class="fw-bold text-uppercase mb-3">
            {{ getMaterialesArray().length > 0 ? 'Materiales incluidos:' : 'Información:' }}
          </h5>
          <ul class="mb-0">
            @if (getMaterialesArray().length > 0) {
              @for (material of getMaterialesArray(); track $index) {
                <li>{{ material }}</li>
              }
            } @else {
              @if (curso()?.nombreCategoria) {
                <li>Categoría: {{ curso()?.nombreCategoria }}</li>
              }
              @if (curso()?.otorgaCertificado) {
                <li>✓ Otorga certificado de finalización</li>
              }
              @if ((curso()?.programaciones || []).length > 0) {
                <li>{{ (curso()?.programaciones || []).length }} programación(es) disponible(s)</li>
              }
            }
          </ul>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card p-3 h-100 requisitos-box">
          <h5 class="fw-bold text-uppercase mb-3">
            {{ getRequisitosArray().length > 0 ? 'Requisitos:' : 'Programaciones:' }}
          </h5>
          <ul class="mb-0">
            @if (getRequisitosArray().length > 0) {
                @for (requisito of getRequisitosArray(); track $index) {
                <li>{{ requisito }}</li>
              }
            } @else {
                @for (prog of (curso()?.programaciones || []); track prog.idProgramacionCurso) {
                <li>
                  <strong>{{ getNombreCompleto(prog) }}</strong>
                  @if (prog.horario) {
                    <span> - {{ prog.horario }}</span>
                  }
                  - {{ getModalidadLabel(prog.modalidad) }}
                  - Desde {{ prog.fechaInicio | date: 'dd/MM/yyyy' }}
                  - S/. {{ prog.monto | number: '1.2-2' }}
                </li>
              }
            }
          </ul>
        </div>
      </div>
    </div>

    <div class="text-center">
      <button class="btn btn-carrito mx-2 fw-bold rounded-pill" type="button">
        Añadir al carrito
      </button>
      <button class="btn btn-comprar mx-2 fw-bold rounded-pill" type="button" (click)="comprar()">Matricularse</button>
    </div>
  }
</section>
